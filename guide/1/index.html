<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>如何发布一个NPM包 | 老白的驿站</title><meta name="description" content="当我们自己写了一个通用的 JavaScript 模块，想要分享出去给别人使用，一般都会把它作为 npm 包发布到官方仓库中，需要使用的时候再通过 `npm install xxx` 来安装即可。那么如何发布一个 npm 包呢？">
    <link rel="modulepreload" href="/blog_v2/assets/app.8f226db3.js"><link rel="modulepreload" href="/blog_v2/assets/index.html.f37d1093.js"><link rel="modulepreload" href="/blog_v2/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog_v2/assets/index.html.96d7dd1d.js">
    <link rel="stylesheet" href="/blog_v2/assets/style.51739c08.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog_v2/" class=""><!----><span class="site-name can-hide">老白的驿站</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/blog_v2/" class="nav-link sidebar-heading sidebar-item" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a><!----><!--]--><!--[--><p class="sidebar-heading sidebar-item">学习笔记</p><ul class=""><li><!--[--><a aria-current="page" href="/blog_v2/guide/1" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item" aria-label="如何发布一个NPM包"><!--[--><!--]--> 如何发布一个NPM包 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">生活记录</p><ul class=""><li><!--[--><a href="/blog_v2/life/21-12/1.html" class="nav-link sidebar-item" aria-label="双十二"><!--[--><!--]--> 双十二 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog_v2/life/21-12/2.html" class="nav-link sidebar-item" aria-label="回家"><!--[--><!--]--> 回家 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="如何发布一个npm包" tabindex="-1"><a class="header-anchor" href="#如何发布一个npm包" aria-hidden="true">#</a> 如何发布一个NPM包</h1><p>当我们自己写了一个通用的 JavaScript 模块，想要分享出去给别人使用，一般都会把它作为 npm 包发布到官方仓库中，需要使用的时候再通过 <code>npm install xxx</code> 来安装即可。</p><p>那么如何发布一个 npm 包呢？</p><h3 id="创建项目" tabindex="-1"><a class="header-anchor" href="#创建项目" aria-hidden="true">#</a> 创建项目</h3><p>假设我们要创建一个可以提供算数方法的 npm 包，那么在本地创建一个目录，名为 <code>calculator</code> ，并进入。 注：这个名字仅为说明之用，实际需要使用一个独一无二的包名，可到 npm 官网上查看自己的包名是否有重复）</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> calculator
$ <span class="token builtin class-name">cd</span> calculator/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>既然是发布 npm 包，自然要通过 npm 来进行管理，首先在目录下创建 <code>package.json</code> 文件。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> init --yes <span class="token comment"># 使用 --yes 可以自动将创建过程中的问题以 y 回答</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// package.json</span>

<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;calculator&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>而后开始书写我们的程序，创建 index.js 文件，注意这里我们是在根目录创建的 index.js 文件，这个文件名及位置，需要与 <code>package.js</code> 中的 <code>main</code> 字段保持一致，加入我们想换一个位置和文件作为项目入口，可以手动修改 <code>main</code> 字段，如 <code>src/index.js</code>。</p><p>在入口文件中，添加并导出一个 <code>add</code> 方法</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>至此，我们的模块就完成了。现在进行发布。</p><p>首先，检查一下本地的 <code>npm registry</code> 是不是指向 npm 官方仓库，因为可能大多数人都将其改为指向淘宝镜像了。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> config get registry
http://registry.npmjs.org/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="登录npm" tabindex="-1"><a class="header-anchor" href="#登录npm" aria-hidden="true">#</a> 登录NPM</h3><p>确认无误后，登录 npm</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> addUser <span class="token comment"># 假若没有账号，则注册一个</span>
$ <span class="token function">npm</span> login   <span class="token comment"># 假若已经有账号了，则直接登录</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输入上面命令后，会陆续让回答几个问题，如 Username, Password, Email 等，都正确填写完就会自动登录成功了。</p><ul><li>需要注意的是，使用 <code>npm addUser</code> 注册成功后，会向填写的邮箱当中发送一条认证邮件，需要先到邮箱中点击认证链接跳转页面认证成功后，才可以继续使用 npm 的功能。</li></ul><h3 id="发布" tabindex="-1"><a class="header-anchor" href="#发布" aria-hidden="true">#</a> 发布</h3><p>现在到了激动人心的发布的时候了，在命令行输入，将会得到类似下面的输出</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> publish
<span class="token function">npm</span> notice 
<span class="token function">npm</span> notice 📦  calculator@1.0.0
<span class="token function">npm</span> notice <span class="token operator">==</span><span class="token operator">=</span> Tarball Contents <span class="token operator">==</span><span class="token operator">=</span> 
<span class="token function">npm</span> notice 57B  index.js    
<span class="token function">npm</span> notice 222B package.json
<span class="token function">npm</span> notice <span class="token operator">==</span><span class="token operator">=</span> Tarball Details <span class="token operator">==</span><span class="token operator">=</span> 
<span class="token function">npm</span> notice name:          calculator                                
<span class="token function">npm</span> notice version:       <span class="token number">1.0</span>.0                                   
<span class="token function">npm</span> notice package size:  <span class="token number">328</span> B                                   
<span class="token function">npm</span> notice unpacked size: <span class="token number">279</span> B                                   
<span class="token function">npm</span> notice shasum:        c12fd4fd33d92627f754cc4b0d029b6b3df9c4b8
<span class="token function">npm</span> notice integrity:     sha512-rzIopSWVPTszG<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>8RAsoK6tzRYcg<span class="token operator">==</span>
<span class="token function">npm</span> notice total files:   <span class="token number">2</span>                                       
<span class="token function">npm</span> notice 
+ calculator@1.0.0
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>注意如果这里报错，很有可能是自己的包名或版本跟 npm 仓库中已有的包名或版本冲突了，所以建议自己起一个独一无二的名字，并且到 https://www.npmjs.com/ 中搜索一下，如果没有搜到的包名，则说明可以使用了。到 <code>package.json</code> 中，将 <code>name</code> 字段改为新的可用的包名，然后再重新 <code>npm publish</code> 即可。</li></ul><p>现在再到 npm 官网上去搜索该包名，应该可以查到了。</p><p>使用的时候，像其他普通 npm 一样，直接使用 <code>npm install xxx</code> 即可。</p><h3 id="更新" tabindex="-1"><a class="header-anchor" href="#更新" aria-hidden="true">#</a> 更新</h3><p>假如我们的 npm 包做了一个修改，比如说新增了一个乘法的函数，如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>由于是新增功能，所以我们的版本号需要再第二位进1️，可以到 <code>package.json</code> 中将 <code>version</code> 字段手动改为 <code>1.1.0</code> 。</p><p>也可以使用 npm 提供的功能进行版本修改，如</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> version minor  <span class="token comment"># 修改主版本号，有 break change 的大版本升级时使用</span>
$ <span class="token function">npm</span> version major  <span class="token comment"># 修改中间号，向后兼容，新增功能时使用</span>
$ <span class="token function">npm</span> version patch  <span class="token comment"># 修改补丁号，修复bug时使用</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>这里简单说下版本号语义，我们的三位版本号如 <code>1.0.0</code> ，所对应上面的就是 <code>minor.major.patch</code> ，当阅读和修改版本号时，需按此规范。</li></ul><p>希望通过对 npm 包的发布流程的了解，可以让 node.js 模块显得不那么神秘，也让我们对它的理解也可以进步一点点。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">更新时间: </span><span class="meta-item-info">2021/12/22 下午4:17:52</span></div><div class="meta-item contributors"><span class="meta-item-label">作者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: sikychen@gmail.com">sikychen</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog_v2/assets/app.8f226db3.js" defer></script>
  </body>
</html>
